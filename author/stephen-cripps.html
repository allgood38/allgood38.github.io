<!DOCTYPE html>
<html lang="en">
<head>
        <title>Software Grit - Stephen Cripps</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://allgood38.github.io/theme/css/main.css" type="text/css" />
   

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://allgood38.github.io/css/ie.css"/>
                <script src="http://allgood38.github.io/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://allgood38.github.io/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="https://github.com/allgood38">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://allgood38.github.io">Software Grit  <strong>All that is shell</strong></a></h1>
                <nav><ul>
                                                                    <li><a href="http://allgood38.github.io/pages/about-this-blog.html">About this blog</a></li>
                                                                    <li ><a href="http://allgood38.github.io/category/misc.html">Misc</a></li>
                                    <li ><a href="http://allgood38.github.io/category/programming.html">Programming</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://allgood38.github.io/how-to-break-your-git-submodules.html">How to break your git submodules</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-05-13T11:30:00">
                Mon 13 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://allgood38.github.io/author/stephen-cripps.html">Stephen Cripps</a>
        </address>
        <p>In <a href="http://allgood38.github.io/category/programming.html">Programming</a>. </p>
<p>tags: <a href="http://allgood38.github.io/tag/programming.html">programming</a><a href="http://allgood38.github.io/tag/git.html">git</a></p></footer><!-- /.post-info --><p>I have been using a large variety of plugins in vim, and a few months ago I started using git submodules and pathogen to manage them. With the help of a script to take care of some of the common operations, such as updating all of the plugins at once and committing them, things worked pretty smoothly.</p>
<p>Then one day I cloned the repository over to another computer and told git to update the submodules, where it then halted the procedure and asked me for my github username and password. This doesn't make any sense though, since I don't own the repository it was cloning from, and when I did enter the credentials it failed predictably saying it couldn't find the repository under my username.</p>
<p>The problem stems from my inexperience with git submodules, particularly with the way it handles changes to the submodule repositories. </p>
<div class="highlight"><pre><span class="o">[</span>galactor<span class="o">][</span>allgood38<span class="o">]</span><span class="nv">$ </span>tree -d -L 2
    .
    ├── autoload
    ├── bundle
    │   ├── <span class="nb">command</span>-t.git
    │   ├── gundo.vim.git
    │   ├── LaTeX-Box.git
    │   ├── nerdcommenter.git
    │   ├── nerdtree.git
    │   ├── ScrollColors.git
    │   ├── snipmate-snippets.git
    │   ├── supertab.git
    │   ├── syntastic.git
    │   ├── YouCompleteMe.git
    │   ...
    ├── colors
    ├── ftdetect
    ├── ftplugin
    ├── plugin
    ├── snippets
    ├── spell
    └── syntax
</pre></div>


<p>Above is the directory structure of my vimfiles repository. Each of the folders ending in <code>.git</code> are submodules. Submodules don't need to end with this, its just the way I chose to handle it with my management script. It also makes it clear that the folder is in fact a submodule. </p>
<p>The problem was created when I ran vim, and the plugin in the submodule folder altered some of the files, and when I was playing around with the plugins I think I may have committed the changes into the submodule. This is fine if you're a dev working on a plugin, but I had now just created a commit, that would only be visible to me, I didn't upload it to the remote url, which is what git uses to clone the submodule. So now any time I try to clone the repository and update the submodules, it looks for a commit the developer never made, causing it to fail.</p>
<p>The first approach I took was removing the submodule completely and trying to re-add it, however given that I was trying to add it with the same submodule name, git realised there was still references to the old one in its index and refused to do anything.</p>
<p>Eventually I learned that the <code>.git</code> folder within each of the submodule root directories is actually just a text file with a line that references where the real <code>.git</code> folder is within the parent (top-level) repository. As a side note, I noticed all my references where absolute, so if you were to try moving the entire parent repository to another location in the filesystem, submodules also fail.</p>
<p>For example, this is the <code>.git</code> file (not folder) within one of the git submodule working directories:</p>
<div class="highlight"><pre>gitdir: /home/allgood38/.git/vimfiles/.git/modules/<span class="se">\</span>
    vim/bundle/tabular.git
</pre></div>


<p>So I went into the parent's <code>.git</code> folder and went to the path <code>.git/modules/.../submodule.git</code> which contains something very similar to a bare git repository. Once in there I moved one directory up and did:</p>
<div class="highlight"><pre>rm -rf submodule.git/*
git clone --bare submodule-url.git submodule.git
</pre></div>


<p>And now we have a bare repository with the correct HEAD pointer and everything. Now you go into the <code>submodule.git</code> again and open <code>config</code>. Remove the line that says <code>bare: true</code>, since submodules won't actually work as bare repositories. Finally, go to the submodule path in your working directory and type:</p>
<div class="highlight"><pre>git pull origin master
</pre></div>


<p>And the submodule will use the information from the bare repository we just clone to update all of the information. Now if you run <code>git submodule update</code>, you shouldn't have any problems.</p>
<p><em>UPDATE</em>: This doesn't appear to be a permanent solution, but it does get the job done, use with caution.</p><p>There are <a href="http://allgood38.github.io/how-to-break-your-git-submodules.html#disqus_thread">comments</a>.</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                        

                 
                        <li><article class="hentry">    
                <header>
                        <h1><a href="http://allgood38.github.io/i-may-be-no-web-developer-but-i-do-know-shell.html" rel="bookmark" title="Permalink to I may be no web developer, but I do know shell">I may be no web developer, but I do know shell</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-05-15T10:09:00">
                Wed 15 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://allgood38.github.io/author/stephen-cripps.html">Stephen Cripps</a>
        </address>
        <p>In <a href="http://allgood38.github.io/category/misc.html">Misc</a>. </p>
<p>tags: <a href="http://allgood38.github.io/tag/publishing.html">publishing</a><a href="http://allgood38.github.io/tag/python.html">python</a><a href="http://allgood38.github.io/tag/bash.html">bash</a><a href="http://allgood38.github.io/tag/shell.html">shell</a></p></footer><!-- /.post-info -->                <p>My Knowledge of web development is very limited, but with the help of some quick tutorials on the web, I was able to make this page from some basic know-how</p>
                <a class="readmore" href="http://allgood38.github.io/i-may-be-no-web-developer-but-i-do-know-shell.html">read more</a>
                <p>There are <a href="http://allgood38.github.io/i-may-be-no-web-developer-but-i-do-know-shell.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                                    

                 
                        <li><article class="hentry">    
                <header>
                        <h1><a href="http://allgood38.github.io/what-beginners-should-know-about-vim.html" rel="bookmark" title="Permalink to What beginners should know about vim">What beginners should know about vim</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2013-05-16T19:08:06">
                Thu 16 May 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://allgood38.github.io/author/stephen-cripps.html">Stephen Cripps</a>
        </address>
        <p>In <a href="http://allgood38.github.io/category/programming.html">Programming</a>. </p>
<p>tags: <a href="http://allgood38.github.io/tag/programming.html">programming</a><a href="http://allgood38.github.io/tag/text.html">text</a><a href="http://allgood38.github.io/tag/vim.html">vim</a></p></footer><!-- /.post-info -->                <p>Although people new to vim shouldn't use someone else's configuration, there are some settings they should know about, to save them needless frustration</p>
                <a class="readmore" href="http://allgood38.github.io/what-beginners-should-know-about-vim.html">read more</a>
                <p>There are <a href="http://allgood38.github.io/what-beginners-should-know-about-vim.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            <p class="paginator">
        Page 1 / 1
    </p>
                            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
                    <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://getpelican.com/">Pelican</a></li>
                                                    <li><a href="http://python.org/">Python.org</a></li>
                                                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">

        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-40985552-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'softwaregrit';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>